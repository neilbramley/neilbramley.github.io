<!DOCTYPE html>
<html>
<head>
<link rel='stylesheet' type='text/css' href='../static/css/main.css'/>
<script src='../static/lib/jquery.min.js'></script>

</head>

<body onload = 'InitialSelect()'>

    <h2>Instructions</h2>

    <ol>
        <li>Select which Participant triad, World, and Question (faced by the active learner) you would like to watch.</li>
        <li>The dropdown menu shows the accuracy of the three particpants (active, matched and mismatched) for each triad.</li>
        <li>Click 'Load' to load a video of active participant, an information timeline and response details for all three participants</li>
        <li>Play or pause and rewind the video with the controls</li>
        <li>Note additional details about the trial in the text box below</li>
    </ol>

    <h2>Selection controls</h2>
    
    <div id='select_condition' style='position:relative;float:left;''>
        <fieldset style='float:left;width:100px;margin:5px'>
            <legend>Participant triad</legend>
            <select id='participant_select'>
                <option value='01'>1. Active:78%, Same:72%, Flip:89%</option>
                <option value='02'>2. Active:39%, Same:61%, Flip:39%</option>
                <option value='03'>3. Active:50%, Same:44%, Flip:61%</option>
                <option value='04'>4. Active:56%, Same:33%, Flip:44%</option>
                <option value='05'>5. Active:83%, Same:72%, Flip:44%</option>
                <option value='06'>6. Active:72%, Same:89%, Flip:44%</option>
                <option value='07'>7. Active:78%, Same:56%, Flip:56%</option>
                <option value='08'>8. Active:61%, Same:67%, Flip:56%</option>
                <option value='09'>9. Active:89%, Same:78%, Flip:44%</option>
                <option value='10'>10. Active:67%, Same:78%, Flip:72%</option>
                <option value='11'>11. Active:61%, Same:67%, Flip:44%</option>
                <option value='12'>12. Active:50%, Same:83%, Flip:61%</option>
                <option value='13'>13. Active:72%, Same:50%, Flip:22%</option>
                <option value='14'>14. Active:94%, Same:67%, Flip:28%</option>
                <option value='15'>15. Active:89%, Same:44%, Flip:44%</option>
                <option value='16'>16. Active:56%, Same:61%, Flip:50%</option>
                <option value='17'>17. Active:67%, Same:39%, Flip:44%</option>
                <option value='18'>18. Active:28%, Same:67%, Flip:44%</option>
                <option value='19'>19. Active:50%, Same:72%, Flip:72%</option>
                <option value='20'>20. Active:44%, Same:50%, Flip:67%</option>
                <option value='21'>21. Active:67%, Same:56%, Flip:44%</option>
                <option value='22'>22. Active:50%, Same:67%, Flip:56%</option>
                <option value='23'>23. Active:50%, Same:44%, Flip:50%</option>
                <option value='24'>24. Active:78%, Same:89%, Flip:33%</option>
                <option value='25'>25. Active:50%, Same:78%, Flip:56%</option>
                <option value='26'>26. Active:78%, Same:67%, Flip:61%</option>
                <option value='27'>27. Active:89%, Same:33%, Flip:44%</option>
                <option value='28'>28. Active:44%, Same:39%, Flip:44%</option>
                <option value='29'>29. Active:78%, Same:56%, Flip:61%</option>
                <option value='30'>30. Active:100%, Same:50%, Flip:56%</option>
                <option value='31'>31. Active:44%, Same:78%, Flip:78%</option>
                <option value='32'>32. Active:89%, Same:72%, Flip:33%</option>
                <option value='33'>33. Active:83%, Same:78%, Flip:50%</option>
                <option value='34'>34. Active:78%, Same:72%, Flip:67%</option>
                <option value='35'>35. Active:89%, Same:67%, Flip:67%</option>
                <option value='36'>36. Active:72%, Same:72%, Flip:44%</option>
                <option value='37'>37. Active:78%, Same:72%, Flip:56%</option>
                <option value='38'>38. Active:56%, Same:44%, Flip:50%</option>
                <option value='39'>39. Active:50%, Same:28%, Flip:44%</option>
                <option value='40'>40. Active:94%, Same:56%, Flip:56%</option>
            </select>
        </fieldset>
<!-- "Active:78%, Same:72%, Flip:89%"
"Active:39%, Same:61%, Flip:39%"
"Active:50%, Same:44%, Flip:61%"
"Active:56%, Same:33%, Flip:44%"
"Active:83%, Same:72%, Flip:44%"
"Active:72%, Same:89%, Flip:44%"
"Active:78%, Same:56%, Flip:56%"
"Active:61%, Same:67%, Flip:56%"
"Active:89%, Same:78%, Flip:44%"
"Active:67%, Same:78%, Flip:72%"
"Active:61%, Same:67%, Flip:44%"
"Active:50%, Same:83%, Flip:61%"
"Active:72%, Same:50%, Flip:22%"
"Active:94%, Same:67%, Flip:28%"
"Active:89%, Same:44%, Flip:44%"
"Active:56%, Same:61%, Flip:50%"
"Active:67%, Same:39%, Flip:44%"
"Active:28%, Same:67%, Flip:44%"
"Active:50%, Same:72%, Flip:72%"
"Active:44%, Same:50%, Flip:67%"
"Active:67%, Same:56%, Flip:44%"
"Active:50%, Same:67%, Flip:56%"
"Active:50%, Same:44%, Flip:50%"
"Active:78%, Same:89%, Flip:33%"
"Active:50%, Same:78%, Flip:56%"
"Active:78%, Same:67%, Flip:61%"
"Active:89%, Same:33%, Flip:44%"
"Active:44%, Same:39%, Flip:44%"
"Active:78%, Same:56%, Flip:61%"
"Active:100%, Same:50%, Flip:56%"
"Active:44%, Same:78%, Flip:78%"
"Active:89%, Same:72%, Flip:33%"
"Active:83%, Same:78%, Flip:50%"
"Active:78%, Same:72%, Flip:67%"
"Active:89%, Same:67%, Flip:67%"
"Active:72%, Same:72%, Flip:44%"
"Active:78%, Same:72%, Flip:56%"
"Active:56%, Same:44%, Flip:50%"
"Active:50%, Same:28%, Flip:44%"
"Active:94%, Same:56%, Flip:56%" -->


        <fieldset style='float:
        left;width:100px;margin:5px'>
            <legend>World</legend>
            <select id = 'world_select'>
                <option value='1'>1</option>
                <option value='2'>2</option>
                <option value='3'>3</option>
                <option value='4'>4</option>
                <option value='5'>5</option>
                <option value='6'>6</option>
                <option value='7'>7</option>
                <option value='8'>8</option>
                <option value='9'>9</option>
            </select>
        </fieldset>
        
    </div>

    <fieldset style='float:left;width:100px;margin:5px'>
        <legend>Question</legend>
        <input type='radio' name='q_select' id='m' > Mass<br>
        <input type='radio' name='q_select' id='f' > Force<br>
    </fieldset>

    <div style='position:relative;float:left;'>
        &nbsp;  &nbsp;  &nbsp;  
        <button class="button big-btn" id="loadButton"; onclick="LoadVideo();"; >Load</button><br>
    </div>
    
    <div class='spacer' style = 'clear:both'></div>

    <h2>Video window</h2>

    <div id='game' style='position:relative;float:left;'>
        <!-- <iframe src='replay_world.html' width=600 height=400 id='game-frame'></iframe> -->
        <video id = "video" width = "600" height = "550" controls>
        <!-- width = "900" height = "825" controls> -->
            <source id = 'movie_source' type="video/mp4">
            Your browser does not support HTML5 video.
        </video>
    </div>

    
    <div class='spacer' style = 'clear:both'></div>

    <h2>Trial details</h2>

    <div style='position:relative;float:left;width=900;height=150' contenteditable="true" id='conditionDetails' >
    <!-- type='text' readonly='readonly' rows='15' cols='90' -->
    </div>



    <div class='spacer' style = 'clear:both'></div>


<p>Back to supplementary materials <a href="http://cims.nyu.edu/~bramley/el/apl.html" target="_blank">here</a>>



<script>

var w=1;
var p = 1;
var q = 'm';
var resp_data = [];

var ppt_get = undefined;
var world_get = undefined;
var question_get = undefined;

var workerids =
    ['AR1IWBDA7MC86'   ,    'ABL3H3O3BI8ZD'      , 'A32QJF67JMJFKX'    , 
    'A3OW5EFQ5QFD19'  ,    'A15V8K8M4TXT9Y'     , 'A2OWVYIPSQB0QP'    , 
    'A2WX9BYW5TI8OA'  ,    'AOTF48KUV9KWM'      , 'A16SJ5D3DKUEXJ'    , 
    'A14ADQ7RUN6TDY'  ,    'A0017268R9SKD8U2Y3F', 'A2VRDE2FHCBMF8'    , 
    'ALEE1QD4TW9G4'   ,    'A2GB0RI43KU4Z'      , 'A1N4AZ1QXPOPXH'    , 
    'A21H2UDDHN8ZF'   ,    'A1GXFMAC759VRM'     , 'A1VNYP58BTF4HX'    , 
    'A1727A5VJOZAMR'  ,    'A1MQ9B05ZMM4YI'     , 'A6JKKANO7F4KD'     , 
    'A2USG1JP96FTV'   ,    'A2YCMT5BPA0AG9'     , 'A94DL4GI8ZBUO'     , 
    'A1VOWQJOBWOVKG'  ,    'A2DWPP1KKAY0HG'     , 'A1H72Y9Z5NJXDS'    , 
    'A18T7E73TNGOKP'  ,    'A1G187YBG0DVMQ'     , 'A34F2ESTZYTWRM'    , 
    'A115UFR6VA6OM1'  ,    'A3EWTW55UCNAHG'     , 'A3RHGIM99R25Q9'    , 
    'A2YE2I9DYV9OKW'  ,    'A3L0DCUXI7X3A9'     , 'A1H053T5EXI6EP'    , 
    'A1CSDIX05PK9V'   ,    'A1X1GFV9H8AGSL'     , 'A19C6T7B0H4PAQ'    , 
    'A1U8QI4H4ND1FP'];

   function InitialSelect()
    {
        document.getElementById("loadButton").disabled = true;




        //Optional GET setting functionality
        ppt_get = GetTrialVariable('p');
        world_get = GetTrialVariable('w');
        question_get = GetTrialVariable('q');

        //If a get participant variable is sent, initially set this as current participant
        if (ppt_get!==undefined)
        {
            if (Number(ppt_get)<=document.getElementById('participant_select').getElementsByTagName('option').length)
            {
                document.getElementById('participant_select').getElementsByTagName('option')[Number(ppt_get)-1].selected = 'selected'
            } else {
                console.log('bad participant parameter')
            }
        }

        //If a get participant variable is sent, initially set this as current participant
        if (world_get!==undefined)
        {
            if (Number(world_get)<=document.getElementById('world_select').getElementsByTagName('option').length)
            {
                document.getElementById('world_select').getElementsByTagName('option')[Number(world_get)-1].selected = 'selected';
            } else {
                console.log('bad world parameter');
            }
            
        }

        if (question_get!==undefined)
        {
            if (question_get==='m' || question_get==='0')
            {
                document.getElementById('m').checked = true;
            } else if (question_get==='f' || question_get==='1'){
                document.getElementById('f').checked = true;
            } else{
                console.log('bad question parameter!')
            }
        } else {
            //Otherwise choose a question at random
            if (Math.random()>0.5)
            {
                document.getElementById('m').checked = true;
            } else {
                document.getElementById('f').checked = true;
            }
        }



        jQuery.ajax({
        url:  'e45_resps.json',
        type:'GET',
        data:{
              //details: 'details'
              },
              success:function(data){
                  console.log('AJAX success');
                  //console.log(data);
                  resp_data = data;
                  document.getElementById("loadButton").disabled = false;
                  LoadVideo();
              },
              error: function(err){

                  //jQuery('.errorText').fadeIn();
                  alert('Oops there was a problem linking with our database.\n\nPlease email the experimenter at neil.bramley@ucl.ac.uk');
                  
              }
         });
    }

    function LoadVideo()
    {
        // Update params
        w =  document.getElementById('world_select').value;
        p = document.getElementById('participant_select').value;
        
        if (document.getElementById('f').checked==true)
        {
            q = 'f'
        } else {
            q = 'm'
        }

        console.log(w,p,q);

   
        var tmp = resp_data[workerids[Number(p)-1]]['active'];
        
        for (var i=0; i<tmp.worldId.length; i++)
        {
            //nb excludes practice rounds
            if (tmp.worldId[i]===Number(w) & tmp.order[i]!=="1" & tmp.order[i]!=="11")
            {
                if (tmp.question[i]==='mass' & q==='m')
                {
                    
                    t = tmp.order[i];
                    console.log(i, t, 'mass');

                } else if (tmp.question[i]==='relationship' & q==='f')
                {
                    
                    t = tmp.order[i];
                    console.log(i, t, 'force');
                }
            }
        }
        
        if (t<10)
        {
            t = '0' + t;
        }

        filename = '../static/movies/P' + p + '_' + workerids[Number(p)-1] +
        '/w' + w + q + '_t' + t + '.mp4';
        
        console.log(filename);

        document.getElementById("movie_source").src = filename;
        
        //Print details to text window:
        document.getElementById("conditionDetails").innerHTML =  'World: <b>' + resp_data[workerids[Number(p)-1]]["active"]["worldId"][Number(t)-1]  + '</b>&nbsp;&nbsp;&nbsp' +
        '(Trial: <b>' + resp_data[workerids[Number(p)-1]]["active"]["order"][Number(t)-1] + '</b>)<br><br>' +
        'Condition: <b>' + resp_data[workerids[Number(p)-1]]["active"]["condition"][Number(t)-1] + '</b>&nbsp;&nbsp;&nbsp' +
        'Question: <b>' + resp_data[workerids[Number(p)-1]]["active"]["question"][Number(t)-1] + '</b><br>' +
        'Answer: <b>' + resp_data[workerids[Number(p)-1]]["active"]["answer"][Number(t)-1] + '</b>&nbsp;&nbsp;&nbsp' +
         'Correct?: <b>' + ['false','true'][resp_data[workerids[Number(p)-1]]["active"]["cor"][Number(t)-1]] + '</b>&nbsp;&nbsp;&nbsp' +
         'Response time: <b>' + resp_data[workerids[Number(p)-1]]["active"]["resptime"][Number(t)-1] + '</b>&nbsp;&nbsp;&nbsp' +
        '<br><br>' +
        'Condition: <b>' + resp_data[workerids[Number(p)-1]]["yokedSame"]["condition"][Number(t)-1] + '</b><br>' +
        'Answer: <b>' + resp_data[workerids[Number(p)-1]]["yokedSame"]["answer"][Number(t)-1] + '</b>&nbsp;&nbsp;&nbsp' +
        'Correct?: <b>' + ['false','true'][resp_data[workerids[Number(p)-1]]["yokedSame"]["cor"][Number(t)-1]] + '</b>&nbsp;&nbsp;&nbsp' +
        'Response time: <b>' + resp_data[workerids[Number(p)-1]]["yokedSame"]["resptime"][Number(t)-1] + '</b>&nbsp;&nbsp;&nbsp' +
        '<br><br>' +
        'Condition: <b>' + resp_data[workerids[Number(p)-1]]["yokedFlip"]["condition"][Number(t)-1] + '</b>&nbsp;&nbsp;&nbsp' +
        'Question: <b>' + resp_data[workerids[Number(p)-1]]["yokedFlip"]["question"][Number(t)-1] + '</b><br>' +
        'Answer: <b>' + resp_data[workerids[Number(p)-1]]["yokedFlip"]["answer"][Number(t)-1] + '</b>&nbsp;&nbsp;&nbsp' +
        'Correct?: <b>' + ['false','true'][resp_data[workerids[Number(p)-1]]["yokedFlip"]["cor"][Number(t)-1]] + '</b>&nbsp;&nbsp;&nbsp' +
        'Response time: <b>' + resp_data[workerids[Number(p)-1]]["yokedFlip"]["resptime"][Number(t)-1] + '</b>&nbsp;&nbsp;&nbsp';


        resp_data[workerids[Number(p)-1]]["yokedSame"][t] + '\n\n\n' +
        resp_data[workerids[Number(p)-1]]["yokedFlip"][t];

        var video = document.getElementById('video');
        video.load();
        //video.play();
    }

    function GetTrialVariable(variable) {
      var query = window.location.search.substring(1);
      var vars = query.split("&");
      for (var i=0;i<vars.length;i++) {
        var pair = vars[i].split("=");
        if (pair[0] == variable) {
          return pair[1];
        }
      } 
      console.log('Query Variable ' + variable + ' not found');
    }


</script>

</body>
</html>
