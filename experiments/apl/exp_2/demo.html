<!DOCTYPE html>
<html>
<head>
  <link rel="stylesheet" type="text/css" href="static/css/stylesheet.css"/>
  <script src="static/lib/jquery.min.js"></script>

</head>

<body>
<h2>Instructions</h2>
<p>
1. Select the condition and world you want to see below the window.<br>
2. Click "Load".<br>
3. Then click "Start" to play the trial.<br>
4. You can then pause, restart and stop with the other buttons.<br>
5. Select a different settings and click "Load" again to view different worlds and conditions.<br>
6. Refresh the page if it breaks.<br>
7. If it is still broken email nrbramley@gmail.com :).<br>
</p>

  <div>
      <textarea id="conditionDetails" type="text" readonly="readonly" rows="25" cols="40"></textarea>
  </div>

  <div id="game">
    <iframe src="physics_world_exp2.html" width=600 height=400 id="game-frame"></iframe>
    <!-- physics_world_settable.html -->
  </div>
  
  <div id="button">
   <button type="button" name="button"; id="loadButton"; onclick="LoadJS();"; >Load</button>
    <!-- <p id="start" onclick="Start();">Start</p> -->
  </div>

  <div id="button">
   <button type="button" name="button" id="startButton"; onclick="Start();"; >Start</button>
    <!-- <p id="start" onclick="Start();">Start</p> -->
  </div>

  <div id="button">
     <button type="button" name="button" id="stopButton"; onclick="Stop();"; >Stop</button>
    <!-- <p id="resume" onclick="Resume();">Resume</p> -->
  </div>

  <div id="button">
     <button type="button" name="button" id="pauseButton"; onclick="Pause();"; >Pause</button>
    <!-- <p id="pause" onclick="Pause();">Pause</p> -->
  </div>

  <div id="button">
     <button type="button" name="button" id="resumeButton"; onclick="Resume();"; >Resume</button>
    <!-- <p id="resume" onclick="Resume();">Resume</p> -->
  </div>

 <div id="select_condition">
 <p> Select the condition, counterbalance and world you would like to play here (initial selections are random).  When you are ready, click the load button.</p><br>
      <fieldset>
            <legend>Select condition</legend>
            
            <fieldset style="float:left;width:200px;margin:5px">
                Condition<br>
                <input type="radio" name="condition" id="co_pa"  >Passive<br>
                <input type="radio" name="condition" id="co_bg"  >Active<br>
            </fieldset>

            <fieldset style="float:left;width:200px;margin:5px">
                World<br>
                <input type="radio" name="world" id="w1"  >1<br>
                <input type="radio" name="world" id="w2"  >2<br>
                <input type="radio" name="world" id="w3"  >3<br>
                <input type="radio" name="world" id="w4"  >4<br>
                <input type="radio" name="world" id="w5"  >5<br>
                <input type="radio" name="world" id="w6"  >6<br>
                <input type="radio" name="world" id="w7"  >7<br>
                <input type="radio" name="world" id="w8"  >8<br>
                <input type="radio" name="world" id="w9"  >9<br>
            </fieldset>
        </fieldset>
          
            <br><br>
          
</div>

<script>

    //Set up variables
    //var cond=[0,1,0,1,2,1,2,4,0,4,1,0,0];
    var trial_specs = [[0,1],[0,1,2,3,4,5,6,7,8]];
    var choosers = [[co_pa, co_bg],[w1,w2,w3,w4,w5,w6,w7,w8,w9]];
    var cond = [];
    var selected = [];
    var tmp = 0;

    document.getElementById("startButton").disabled = true;
    document.getElementById("stopButton").disabled = true;
    document.getElementById("pauseButton").disabled = true;
    document.getElementById("resumeButton").disabled = true;

    //Initially, randomly select a condition
    for (var i = 0; i<(choosers.length); i++){

      tmp = Math.floor((Math.random() * choosers[i].length));
      //cond[i] = trial_specs[i][tmp];
      console.log(tmp);
      $( choosers[i][tmp] ).prop( "checked", true );
    }
    

    function LoadJS() {

      //Update cond to user's selection
      for (var i = 0; i<(choosers.length); i++){
        for (var j = 0; j<(choosers[i].length); j++){
          if ($( choosers[i][j] ).prop( "checked" ) == true) {
            cond[i] = trial_specs[i][j];  
          }
        }
      }

      $.getJSON('stim2.json', function(json) {
          stim_data = json
      });

      function postloadfunction()
      {
        //Release start button
        document.getElementById("startButton").disabled = false;
        document.getElementById("stopButton").disabled = false;
        document.getElementById("pauseButton").disabled = false;
        document.getElementById("resumeButton").disabled = false;
        //Update cond to user's selection
        for (var i = 0; i<(trial_specs.length); i++){
          for (var j = 0; j<(trial_specs[i].length); j++){
            if ($( choosers[i][j] ).prop( "checked" ) == true) {
              selected[i] = trial_specs[i][j];
              //$( choosers[i][j] ).prop( "checked", true );        
            }
          }
        }
        

        r_forces = [[-3,0,3][Math.floor(Math.random()*3)],
        [-3,0,3][Math.floor(Math.random()*3)],
        [-3,0,3][Math.floor(Math.random()*3)],
        [-3,0,3][Math.floor(Math.random()*3)],
        [-3,0,3][Math.floor(Math.random()*3)]];

        r_masses = [stim_data.stim[selected[1]].world[1],
                    stim_data.stim[selected[1]].world[2], 1, 1];

        r_elasticities = [.98,.98,.98,.98,.98];
        //[  $c.condition, that.trialinfo.world[0],              r_forces, 0, 0,  r_masses, r_elasticities, 0,0,0, STATE.index] //(example from psiturk)
        cond=[selected[0], stim_data.stim[selected[1]].world[0], r_forces, 0, 0,  r_masses, r_elasticities, 0,0,0,      0]

        console.log('stim_data', stim_data.stim, 'selected', selected, 'cond', cond);
      }

      

      window.setTimeout(postloadfunction, 100);
      
    }


    function Start() {
    
      document.getElementById("startButton").disabled = true;

      
      
      console.log('selected trial_spec', cond);

    // ["passive","baby fist","ball grabber"]
    

    //document.getElementById("conditionDetails").value = 


      document.getElementById("conditionDetails").value = 'Condition: ' + ["Passive", "Active (punch)", "Active (grab)"][cond[0]] + '\n\n' +
                                                          'Global force strength: ' + cond[1] + ' m/s^2\n\n' +
                                                          'Global force direction: ' + ['North','North-East','East', 'South-East', 'South','South-West','West','North-West'][cond[2]] + '\n\n' +
                                                          'Yellow: Mass ' + cond[3] + 'Kg  ' +
                                                          'Elasticity ' + cond[4] + '\n\n' +
                                                          'Red: Mass ' + cond[5] + 'Kg  ' +
                                                          'Elasticity ' + cond[6] + '\n\n' +
                                                          'Local force: Yellow-yellow '  + cond[7] + ' m/s^2\n' +
                                                          'Local force: Red-red '  + cond[8] + ' m/s^2\n' +
                                                          'Local force: Yellow-red '  + cond[9] + ' m/s^2\n\n';

  document.getElementById("conditionDetails").value = 'Condition: ' + ["Passive", "Active"][cond[0]] + '\n\n' +
  'Target force: ' + cond[1] + '\n\n' +
  'Distractor forces: ' + cond[2] + '\n\n' +
  'Global force strength: ' + cond[3] + ' m/s^2\n\n' +
  'Global force direction: ' + ['North','North-East','East', 'South-East', 'South','South-West','West','North-West'][cond[4]] + '\n\n' +
  'Object masses ' + cond[5] + 'Kg  ' +
  'Object elasticities ' + cond[6];

      var iframe = document.getElementById("game-frame");


   


      if (iframe) {
        var iframeContent = (iframe.contentWindow || iframe.contentDocument);
        iframeContent.Start();
        iframeContent.RemoveCurtain();
      }
    }

    function Stop() {
      var iframe = document.getElementById("game-frame");
      if (iframe) {
        var iframeContent = (iframe.contentWindow || iframe.contentDocument);
        iframeContent.EndClip();
        // document.getElementById("dataBox").value = 'Events: ' + iframeContent.data.events + '\n\n' +
        // 'Timeline data: ' + iframeContent.data.timeline;
      }

      document.getElementById("startButton").disabled = false;
    }

    function Pause() {
      var iframe = document.getElementById("game-frame");
      if (iframe) {
        var iframeContent = (iframe.contentWindow || iframe.contentDocument);
        iframeContent.Pause();
      }

      document.getElementById("startButton").disabled = false;
    }

    function Resume() {
      var iframe = document.getElementById("game-frame");
      if (iframe) {
        var iframeContent = (iframe.contentWindow || iframe.contentDocument);
        iframeContent.Resume();
      }
    }
  </script>



</body>
</html>
