<!DOCTYPE html>
<html>
<head>
  <link rel="stylesheet" type="text/css" href="../static/css/main.css"/>
  <script src="../static/lib/jquery.min.js"></script>
</head>

<body onload = 'InitialSelect()'>
    <h2>Instructions</h2>

    <ol>
        <li>Use the Start, Pause, Resume and Stop buttons to replay the currently selected particpiant and trial</li>
        <li>To load a different participant or trial first click Stop to end the current replay</li>
        <li>Then select any setting from the options below and click Load, then Start</li>
        <li>Email neil.bramley@nyu.edu if you experience any problems with the interface</li>
    </ol>

    <h2>Task window</h2>

    <div id="game" style="position:relative;float:left;">
        <iframe src="replay_world.html" width=600 height=400 id="game-frame"></iframe>
    </div>
    
    <div style='margin-left:15px;position:relative;float:left;width=150;height=400' contenteditable="true" id='conditionDetails'>
    </div>

    <div class="spacer" style = "clear:both"></div>


    <div style="position:relative;float:left;">
        <button class="button big-btn" id="startButton"; onclick="Start();"; >Start</button>
        <button class="button big-btn" id="pauseButton"; onclick="Pause();"; >Pause</button>
        <button class="button big-btn" id="resumeButton"; onclick="Resume();"; >Resume</button>
        <button class="button big-btn" id="stopButton"; onclick="Stop();"; >Stop</button>
    </div>

    <div class="spacer" style = "clear:both"></div>

    <h2>Selection controls</h2>
    
    <div style='position:relative;float:left;'>
        <fieldset style='float:left;width:450px;margin:5px'>
            <legend>Select participant</legend>
            <select id='participant_select'>  
                <option value="A2MWAXV1YRK5GH"  >1----<b>Active:</b>  <i>Force = 56%  Mass = 22%</i>----<b>Yoked:</b> <i>Force = 67%, Mass = 33% </i></option>
                <option value="A1P0NNR8HOQ95R"  >2----<b>Active:</b>  <i>Force = 56%  Mass = 78%</i>----<b>Yoked:</b> <i>Force = 44%, Mass = 67% </i></option>
                <option value="A3VMKLJTSGYKHN"  >3----<b>Active:</b>  <i>Force = 100% Mass = 89%</i>----<b>Yoked:</b> <i>Force = 100%, Mass = 44%</i> </option>
                <option value="A33QUS4NRVVMTN"  >4----<b>Active:</b>  <i>Force = 67%  Mass = 67%</i>----<b>Yoked:</b> <i>Force = 78%, Mass = 56% </i></option>
                <option value="A25MM8IKSW3G19"  >5----<b>Active:</b>  <i>Force = 44%  Mass = 67%</i>----<b>Yoked:</b> <i>Force = 44%, Mass = 33% </i></option>
                <option value="A2N0FUQBDQRBN5"  >6----<b>Active:</b>  <i>Force = 78%  Mass = 56%</i>----<b>Yoked:</b> <i>Force = 44%, Mass = 56% </i></option>
                <option value="A2Z96TK65BB7LC"  >7----<b>Active:</b>  <i>Force = 89%  Mass = 56%</i>----<b>Yoked:</b> <i>Force = 33%, Mass = 33% </i></option>
                <option value="A3W6T1WDYXMR3"   >8----<b>Active:</b>  <i>Force = 89%  Mass = 78%</i>----<b>Yoked:</b> <i>Force = 78%, Mass = 44% </i></option>
                <option value="AVC1PLLFS210S"   >9----<b>Active:</b>  <i>Force = 89%  Mass = 78%</i>----<b>Yoked:</b> <i>Force = 89%, Mass = 78 %</i></option>
                <option value="A28HYRF3QXFAXL"  >10----<b>Active:</b>  <i>Force = 56%  Mass = 11%</i>----<b>Yoked:</b> <i>Force = 44%, Mass = 33% </i></option>
                <option value="A4J4GGMKJ68L0"   >11----<b>Active:</b>  <i>Force = 67%  Mass = 89%</i>----<b>Yoked:</b> <i>Force = 67%, Mass = 11% </i></option>
                <option value="A27W025UEXS1G0"  >12----<b>Active:</b>  <i>Force = 89%  Mass = 89%</i>----<b>Yoked:</b> <i>Force = 78%, Mass = 78% </i></option>
                <option value="A2EI075XZT9Y2S"  >13----<b>Active:</b>  <i>Force = 78%  Mass = 44%</i>----<b>Yoked:</b> <i>Force = 78%, Mass = 22% </i></option>
                <option value="ANV4TUKMWLA8E"   >14----<b>Active:</b>  <i>Force = 78%  Mass = 33%</i>----<b>Yoked:</b> <i>Force = 67%, Mass = 22% </i></option>
                <option value="ASTDBTVY3WP1K"   >15----<b>Active:</b>  <i>Force = 100% Mass = 56%</i>----<b>Yoked:</b> <i>Force = 67%, Mass = 67% </i></option>
                <option value="AHB3QFZSFN9DL"   >16----<b>Active:</b>  <i>Force = 67%  Mass = 22%</i>----<b>Yoked:</b> <i>Force = 44%, Mass = 44% </i></option>
                <option value="ANZKTE853UXSD"   >17----<b>Active:</b>  <i>Force = 100% Mass = 56%</i>----<b>Yoked:</b> <i>Force = 44%, Mass = 22% </i></option>
                <option value="A38HFMRXB5Q13M"  >18----<b>Active:</b>  <i>Force = 89%  Mass = 56%</i>----<b>Yoked:</b> <i>Force = 100%, Mass = 67%</i> </option>
                <option value="AV22FQTJNBUZT"   >19----<b>Active:</b>  <i>Force = 56%  Mass = 78%</i>----<b>Yoked:</b> <i>Force = 33%, Mass = 56% </i></option>
                <option value="A7RAVFS10BUZ1"   >20----<b>Active:</b>  <i>Force = 22%  Mass = 33%</i>----<b>Yoked:</b> <i>Force = 67%, Mass = 33% </i></option>

                <option value="AG61AWXAA84GD"   >1----<b>Passive:</b>   <i>Force = 44%  Mass = 22%</i></option>
                <option value="A23YOJ16ZTWQ30"   >2----<b>Passive:</b>  <i>Force = 56%  Mass = 67%</i></option>
                <option value="AUAN582MLI96N"   >3----<b>Passive:</b>   <i>Force = 22%  Mass = 22%</i></option>
                <option value="A3QSFE6GKO157S"   >4----<b>Passive:</b>  <i>Force = 78%  Mass = 56%</i></option>
                <option value="A2JI5RNPPXE8QE"    >5----<b>Passive:</b> <i>Force = 89%  Mass = 33%</i></option>
                <option value="A2WX9BYW5TI8OA"   >6----<b>Passive:</b>  <i>Force = 67%  Mass = 11%</i></option>
                <option value="A1T9IKE8GV4LR4"   >7----<b>Passive:</b>  <i>Force = 44%  Mass = 33%</i></option>
                <option value="A36662QQDZ9J3R"   >8----<b>Passive:</b>  <i>Force = 78%  Mass = 78%</i></option>
                <option value="A195MOXRMNHRVT"   >9----<b>Passive:</b>  <i>Force = 56%  Mass = 22%</i></option>
                <option value="A3GDTSFHVBUJHD"  >10----<b>Passive:</b>  <i>Force = 89%  Mass = 22%</i></option>
                <option value="A3B7TNVOISSZ2O"  >11----<b>Passive:</b>  <i>Force = 89%  Mass = 44%</i></option>
                <option value="A1JNC3HWWHJD2J"  >12----<b>Passive:</b>  <i>Force = 78%  Mass = 56%</i></option>
                <option value="A376BI2RNUIFRH"  >13----<b>Passive:</b>  <i>Force = 56%  Mass = 56%</i></option>
                <option value="A306GWTM2KVPJ0"  >14----<b>Passive:</b>  <i>Force = 78%  Mass = 44%</i></option>
                <option value="A212QVOGP76UH2"  >15----<b>Passive:</b>  <i>Force = 44%  Mass = 56%</i></option>
                <option value="A1Z7J3XE1R8TYT"  >16----<b>Passive:</b>  <i>Force = 22%  Mass = 44%</i></option>
                <option value="A3EJ44J2ZNRMDA"  >17----<b>Passive:</b>  <i>Force = 44%  Mass = 56%</i></option>
                <option value="A2K9HSMVUUZJSI"  >18----<b>Passive:</b>  <i>Force = 67%  Mass = 33%</i></option>
                <option value="A207149DHAS89K"  >19----<b>Passive:</b>  <i>Force = 67%  Mass = 56%</i></option>
                <option value="A4E1UYPDHE8D8"  >20----<b>Passive:</b>   <i>Force = 89%  Mass = 22%</i></option>
                <option value="A2JGSSRI6SJ8P6"  >21----<b>Passive:</b>  <i>Force = 22%  Mass = 89%</i></option>
                <option value="A85ATJSDTIARY"   >22----<b>Passive:</b>  <i>Force = 89%  Mass = 56%</i></option>
                <option value="A19L9MK673JAAG"  >23----<b>Passive:</b>  <i>Force = 56%  Mass = 67%</i></option>
                <option value="A2FFNO6G4FEE2N"  >24----<b>Passive:</b>  <i>Force = 44%  Mass = 44%</i></option>
            </select>
            <br>
            <p class=small>Force = participants' mean accuracy on force questions<br>
            Mass = participants' mean accuracy on mass questions</p>
        </fieldset>
    </div>

    <div style="position:relative;float:left;">
        <fieldset style="float:left;width:150px;margin:5px">
            <legend>Select trial:</legend>
            <select id = "trial_select">
                <option value="1"  >1 (practice)</option>
                <option value="2"  >2 (practice)</option>
                <option value="3"  >3</option>
                <option value="4"  >4</option>
                <option value="5"  >5</option>
                <option value="6"  >6</option>
                <option value="7"  >7</option>
                <option value="8"  >8</option>
                <option value="9"  >9</option>
                <option value="10"  >10</option>
                <option value="11"  >11</option>
            </select>
        </fieldset>
    </div>

    <!-- Mapping of participants to worker IDs (ACTIVE)-->
     <!-- 1  A2MWAXV1YRK5GH -->
     <!-- 2  A1P0NNR8HOQ95R -->
     <!-- 3  A3VMKLJTSGYKHN -->
     <!-- 4  A33QUS4NRVVMTN -->
     <!-- 5  A25MM8IKSW3G19 -->
     <!-- 6  A2N0FUQBDQRBN5 -->
     <!-- 7  A2Z96TK65BB7LC -->
     <!-- 8  A3W6T1WDYXMR3 -->
     <!-- 9  AVC1PLLFS210S -->
    <!-- 10  A28HYRF3QXFAXL -->
    <!-- 11  A4J4GGMKJ68L0 -->
    <!-- 12  A27W025UEXS1G0 -->
    <!-- 13  A2EI075XZT9Y2S -->
    <!-- 14  ANV4TUKMWLA8E -->
    <!-- 15  ASTDBTVY3WP1K -->
    <!-- 16  AHB3QFZSFN9DL -->
    <!-- 17  ANZKTE853UXSD -->
    <!-- 18  A38HFMRXB5Q13M -->
    <!-- 19  AV22FQTJNBUZT -->
    <!-- 20  A7RAVFS10BUZ1 -->

<!-- Mapping of participants to worker IDs (Passive)-->
<!--
1 "AG61AWXAA84GD"
2 "A23YOJ16ZTWQ30"
3 "AUAN582MLI96N"
4 "A3QSFE6GKO157S"
5 "A2JI5RNPPXE8QE" 
6 "A2WX9BYW5TI8OA"
7 "A1T9IKE8GV4LR4"
8 "A36662QQDZ9J3R"
9 "A195MOXRMNHRVT"
10"A3GDTSFHVBUJHD" 
11"A3B7TNVOISSZ2O"
12"A1JNC3HWWHJD2J"
13"A376BI2RNUIFRH"
14"A306GWTM2KVPJ0"
15"A212QVOGP76UH2"
16"A1Z7J3XE1R8TYT" 
17"A3EJ44J2ZNRMDA"
18"A2K9HSMVUUZJSI"
19"A207149DHAS89K"
20"A4E1UYPDHE8D8"
21"A2JGSSRI6SJ8P6"
22"A85ATJSDTIARY" 
23"A19L9MK673JAAG"
24"A2FFNO6G4FEE2N" -->


    <div style="position:relative;float:left;">
        <button class="button big-btn" id="loadButton"; onclick="LoadJS();"; >Load</button><br>
    </div>

    <div class="spacer" style = "clear:both"></div>

    <img id = "timeline" width="900" onerror="this.src='../static/images/default.png'">

    <p>Back to supplementary materials <a href="http://cims.nyu.edu/~bramley/el/apl.html" target="_blank">here</a>

<script>

var ppt = undefined;
var trial = undefined;
var selected = [];
var which_selected = [];
var tl_data = [];
var cond = [];

document.getElementById("startButton").disabled = true;
document.getElementById("stopButton").disabled = true;
document.getElementById("pauseButton").disabled = true;
document.getElementById("resumeButton").disabled = true;

function InitialSelect()
{      
    
    //Optional GET setting functionality
    ppt_get = GetTrialVariable('p');
    trial_get = GetTrialVariable('t');

    //If a get participant variable is sent, initially set this as current participant
    if (ppt_get!==undefined)
    {
        //Set by workerid   
        var options = document.getElementById('participant_select').options;
        for (var i = 0, optionsLength = options.length; i < optionsLength; i++) {
            if (options[i].value == ppt_get) {
                options.selectedIndex = i;
            }
        }
        //document.getElementById('participant_select').getElementsByTagName('option')[ppt_get].selected = 'selected';
        console.log('set participant from GET to', ppt_get);
    } else {
        //Otherwise choose a random one
        var rand_ppt = Math.floor(Math.random() * document.getElementById('participant_select').length);
        document.getElementById('participant_select')[rand_ppt].selected = 'selected';
    }

    //If a get trial variable is sent, initially set this as current participant
    if (trial_get!==undefined)
    {
        document.getElementById('trial_select').getElementsByTagName('option')[Number(trial_get)-1].selected = 'selected';
        console.log('set trial from GET to', trial_get);
    } else {
        //Otherwise choose a random one
        var rand_trial = Math.floor(Math.random() * document.getElementById('trial_select').length);
        document.getElementById('trial_select')[rand_trial].selected = 'selected';
    }

    //Load the initial trial data
    LoadJS()
}




function LoadJS() {

    //Update participant and trial
    ppt = document.getElementById('participant_select').value;
    trial = document.getElementById('trial_select').value;

    
    console.log('participant', ppt, 'trial', trial);

    //Load all trial details
    jQuery.ajax({
        url:  "e23_resps.json",
        type:'GET',
        data:{
              //details: "details"
          },
          success:function(data){
              console.log('AJAX success');
              console.log(data);
              stim_data = data;
              postloadfunction()
          },
          error: function(err){
              alert('Oops there was a problem linking with our database.\n\nPlease email the experimenter at neil.bramley@nyu.edu');    
          }
    });

    //Now load current participant's physics data
    function postloadfunction()
    {
        var urlname = "replay_files/ppt_" + ppt + ".json";
        console.log(urlname);
        jQuery.ajax({
            url:  urlname,
            type:'GET',
            data:{ 
            //
            },
            success:function(data){
                console.log('AJAX success 2');
                console.log(data);
                all_timeline_data = data;
                postloadfunction2();
            },
            error: function(err){
            //jQuery('.errorText').fadeIn();
            alert('Oops there was a problem linking with our database.\n\nPlease email the experimenter at neil.bramley@nyu.edu');
            }
        });
        
    }

    //Now select the right stuff for the current trial
    function postloadfunction2()
    {

        document.getElementById("startButton").disabled = false;
        document.getElementById("stopButton").disabled = true;
        document.getElementById("pauseButton").disabled = true;
        document.getElementById("resumeButton").disabled = true;


        //The current physics data
        tl_data = all_timeline_data[Number(trial)-1];
        details = stim_data[ppt][Number(trial)-1];
        //??
        cond = [[details.h1,details.h2, details.h3, details.h4], Number(trial)-1];

        
        //Clunky workaround to update the letters depending on the trial
        var letters = [String.fromCharCode(63 + 2*Number(trial)), String.fromCharCode(65 + 2*Number(trial) + 1)];
        var rightLetter = '';
        if (details.trueMass == 'A')
        {
            rightLetter = letters[0];
        } else if (details.trueMass == 'B')
        {
            rightLetter = letters[1];
        } else if (details.trueMass == 'same')
        {
            rightLetter = 'same';
        }

        var guessLetter = '';
        if (details.mass == 'A')
        {
            guessLetter =letters[0];
        } else if (details.mass == 'B')
        {
            guessLetter = letters[1];
        } else if (details.mass == 'same')
        {
            guessLetter = 'same';
        }

        
        document.getElementById("timeline").src="../static/images/p" + ppt + '/t' + details.worldId + '.png';

        document.getElementById("conditionDetails").innerHTML = 'Condition: ' + ['Passive','Active'][details.condition] + '<br><br>' +
            'Trial: ' + trial + '<br>' +
            'World: ' + details.worldId + '<br><br>' +
            'GROUND TRUTH<br><br>' +
            'Target force: ' + details.trueRelationship + '<br>' +
            'Target heavier: ' + rightLetter + '<br><br>' +
            "PARTICIPANT RESPONSES<br><br>" + 
            "Force response: " + details.relationship + "<br>confidence: " + details.relationshipconf + '<br><br>' +
            "Mass response: " + guessLetter + "<br>confidence: " + details.massconf;
    }
     
}



function Start() {

    document.getElementById("startButton").disabled = true;
    document.getElementById("loadButton").disabled = true;
    document.getElementById("pauseButton").disabled = false;
    document.getElementById("resumeButton").disabled = true;
    document.getElementById("stopButton").disabled = false;
    document.getElementById("loadButton").disabled = true;

    //Fire the start function within the iframe
    var iframe = document.getElementById("game-frame");

    if (iframe) {
        var iframeContent = (iframe.contentWindow || iframe.contentDocument);
        iframeContent.Start();
        iframeContent.RemoveCurtain();
    }
}


function Stop() {
    var iframe = document.getElementById("game-frame");
    if (iframe) {
        var iframeContent = (iframe.contentWindow || iframe.contentDocument);
        iframeContent.EndClip();
    }
    document.getElementById("loadButton").disabled = false;
    document.getElementById("startButton").disabled = false;
    document.getElementById("pauseButton").disabled = true;
    document.getElementById("resumeButton").disabled = true;
    document.getElementById("stopButton").disabled = true;
}

function Pause() {
    var iframe = document.getElementById("game-frame");
    if (iframe) {
        var iframeContent = (iframe.contentWindow || iframe.contentDocument);
        iframeContent.Pause();
    }
    document.getElementById("startButton").disabled = true;
    document.getElementById("loadButton").disabled = true;
    document.getElementById("pauseButton").disabled = true;
    document.getElementById("resumeButton").disabled = false;
}

function Resume() {
    var iframe = document.getElementById("game-frame");
    if (iframe) {
        var iframeContent = (iframe.contentWindow || iframe.contentDocument);
        iframeContent.Resume();
    }
    document.getElementById("startButton").disabled = true;
    document.getElementById("loadButton").disabled = true;
    document.getElementById("pauseButton").disabled = false;
    document.getElementById("resumeButton").disabled = true;
}



function GetTrialVariable(variable) {
    var query = window.location.search.substring(1);
    var vars = query.split("&");
    for (var i=0;i<vars.length;i++) {
        var pair = vars[i].split("=");
        if (pair[0] == variable) {
            return pair[1];
        }
    } 
    console.log('Query Variable ' + variable + ' not found');
}



</script>



</body>
</html>
